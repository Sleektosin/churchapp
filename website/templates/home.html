<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard</title>
    <link
      type="text/css"
      rel="stylesheet"
      href="{{url_for('static',filename='styles/style.min.css')}}"
    />
    <link type="text/css" rel="stylesheet" href="{{url_for('static',filename='styles/style.min.css')}}" />
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css"/>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css"/>
    <!-- DataTables JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <script src="{{url_for('static',filename='lib/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js')}}"></script>
    <script src="{{url_for('static',filename='javascript/sidebarmenu.js')}}"></script>
    <script src="{{url_for('static',filename='javascript/custom.min.js')}}"></script>

    <style>
      .card-animate {
          -webkit-transition: all .4s;
          transition: all .4s;
      }
      .counter-value {
          font-size: 1.5rem;
          font-weight: bold;
      }
      .avatar-sm {
          height: 3rem;
          width: 3rem;
      }
      .avatar-title {
          -webkit-box-align: center;
          -ms-flex-align: center;
          align-items: center;
          background-color: #4b38b3;
          color: #fff;
          display: -webkit-box;
          display: -ms-flexbox;
          display: flex;
          font-weight: 500;
          height: 100%;
          -webkit-box-pack: center;
          -ms-flex-pack: center;
          justify-content: center;
          width: 100%;
      }
      .ff-secondary {
          font-family: Inter, sans-serif;
      }
      .card-height-100 {
          height: 100%;
      }
    </style>
</head>
<body>
    <div
    id="main-wrapper"
    data-layout="vertical"
    data-navbarbg="skin5"
    data-sidebartype="full"
    data-sidebar-position="absolute"
    data-header-position="absolute"
    data-boxed-layout="full">
            {% include "include/header.html" %}
            {% include "include/leftnavbar.html" %}
            <div class="page-wrapper">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <!-- Card -->
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="jumbotron p-3">
                                                <h2>Analytics Dashboard</h2>
                                                <hr>
                                                
                                                <div class="row">
                                                    <div class="col-md-6 col-lg-3">
                                                        <div class="card card-animate">
                                                            <div class="card-body">
                                                                <div class="d-flex justify-content-between">
                                                                    <div>
                                                                        <p class="fw-medium text-muted mb-0">Registered Users</p>
                                                                        <h2 class="mt-4 ff-secondary fw-semibold"><span class="counter-value">{{user_count}}</span></h2>
                                                                    </div>
                                                                    <div>
                                                                        <div class="avatar-sm flex-shrink-0">
                                                                            <span class="avatar-title bg-primary rounded-circle fs-2">
                                                                              <i class="fas fa-users"></i>
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="col-md-6 col-lg-3">
                                                        <div class="card card-animate">
                                                            <div class="card-body">
                                                                <div class="d-flex justify-content-between">
                                                                    <div>
                                                                        <p class="fw-medium text-muted mb-0">Number of Activities</p>
                                                                        <h2 class="mt-4 ff-secondary fw-semibold"><span class="counter-value">{{session_count}}</span></h2>
                                                                    </div>
                                                                    <div>
                                                                        <div class="avatar-sm flex-shrink-0">
                                                                            <span class="avatar-title bg-danger rounded-circle fs-2">
                                                                              <i class="fas fa-calendar-alt"></i>
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="col-md-6 col-lg-3">
                                                        <div class="card card-animate">
                                                            <div class="card-body">
                                                                <div class="d-flex justify-content-between">
                                                                    <div>
                                                                        <p class="fw-medium text-muted mb-0">Registered Male</p>
                                                                        <h2 class="mt-4 ff-secondary fw-semibold"><span class="counter-value">{{male_count}}</span></h2>
                                                                    </div>
                                                                    <div>
                                                                        <div class="avatar-sm flex-shrink-0">
                                                                            <span class="avatar-title bg-warning rounded-circle fs-2">
                                                                              <i class="fas fa-male"></i>
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="col-md-6 col-lg-3">
                                                        <div class="card card-animate">
                                                            <div class="card-body">
                                                                <div class="d-flex justify-content-between">
                                                                    <div>
                                                                        <p class="fw-medium text-muted mb-0">Registered Female</p>
                                                                        <h2 class="mt-4 ff-secondary fw-semibold"><span class="counter-value">{{female_count}}</span></h2>
                                                                    </div>
                                                                    <div>
                                                                        <div class="avatar-sm flex-shrink-0">
                                                                            <span class="avatar-title bg-success rounded-circle fs-2">
                                                                              <i class="fas fa-female"></i>
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="row mt-4">
                                                    <div class="col-md-6">
                                                        <div class="card">
                                                            <div class="card-header">
                                                                <h4 class="card-title">Session Summary</h4>
                                                            </div>
                                                            <div class="card-body">
                                                                <div class="table-responsive">
                                                                    <table id="activityTable" class="table table-striped table-bordered">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Date</th>
                                                                                <th>Activity Name</th>
                                                                                <th>User Count</th>
                                                                                <th>Action</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <!-- Activities will be dynamically added here -->
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="col-md-6">
                                                        <div class="card">
                                                            <div class="card-header">
                                                                <h4 class="card-title">Gender Counts by Date</h4>
                                                            </div>
                                                            <div class="card-body">
                                                                <canvas id="genderChart"></canvas>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            {% include "include/footer.html" %}
    </div>

    <script>
      // Ensure the JSON data is parsed correctly
      const data = JSON.parse('{{ data|safe }}');
      
      const labels = Object.keys(data);
      const maleCounts = labels.map(date => data[date].male);
      const femaleCounts = labels.map(date => data[date].female);
      
      const chartData = {
          labels: labels,
          datasets: [
              {
                  label: 'Male',
                  data: maleCounts,
                  backgroundColor: 'rgba(54, 162, 235, 0.2)',
                  borderColor: 'rgba(54, 162, 235, 1)',
                  borderWidth: 1
              },
              {
                  label: 'Female',
                  data: femaleCounts,
                  backgroundColor: 'rgba(255, 99, 132, 0.2)',
                  borderColor: 'rgba(255, 99, 132, 1)',
                  borderWidth: 1
              }
          ]
      };
      
      const ctx = document.getElementById('genderChart').getContext('2d');
      const genderChart = new Chart(ctx, {
          type: 'bar',
          data: chartData,
          options: {
              responsive: true,
              scales: {
                  y: {
                      beginAtZero: true
                  }
              }
          }
      });
    </script>
    
    <script>
      $(document).ready(function() {
          // Initialize DataTable
          var session_Data = $('#activityTable').DataTable({
            processing: true,
            responsive: true,
            pageLength: 10,
            paging: true,
            lengthMenu: [
            [5,10, 15,20, 25, 50, 60, -1],
            [5,10, 15,20, 25, 50, 60, "All"],
            ],
            serverSide: true,
            order: [[0, "desc"]], // This sorts the first column (date) in descending order
            sort: true,
            searching: true,
            ajax: {
            url: "/get_sessions_summary_data",
            type: "POST",
            },
            columns: [
              { data: "date" },
              { data: "name" },
              { data: "user_count" },
              {
                data: null,
                render: function (data, type, row) {
                // Create a container with custom CSS classes for styling
                return (
                  '<div class="action-buttons">' +
                  '<button id="edit-button-' + data.Id + '" class="btn btn-warning btn-xs edit-button" onclick="editRow(' +
                    "'" + data.Id + "'" + 
                    ',' + "'" + data.name + "'" +
                    ',' + "'" + data.description + "'" +
                    ',' + "'" + data.date + "'" +
                    ',' + "'" + data.user_count + "'" +
                    ')"><i class="fas fa-edit"></i></button>&nbsp;&nbsp;' +   
                    '<a href="/activity/' + data.Id + '" class="btn btn-info btn-xs add-button"><i class="fas fa-plus"></i></a>&nbsp;&nbsp;' +            
                    '<button  class="btn btn-danger btn-xs delete-button" onclick="deleteRow(' + data.Id +
                    ')"><i class="fas fa-trash-alt"></i></button>' +
                    "</div>"
                );
              },
            },
          ],                          
          });    
      });
    </script>
</body>
</html>